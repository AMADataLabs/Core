FROM python:{{ python_version }} AS Base
WORKDIR /{{ project_name }}

# Needed for AMA local development builds
COPY ./Build/Master/rootca.pem .
RUN pip config set global.cert rootca.pem

RUN pip install python{{ python_version }}-dev unixodbc-dev pipenv


FROM Base as PythonDependencies
WORKDIR /{{ project_name }}
COPY ./Environment/{{ project_name }}/Pipfile .
RUN pipenv install


FROM PythonDependencies as Code
WORKDIR /{{ project_name }}
COPY {{ repo_directory }}/Source/ .
COPY {{ repo_directory }}/Test/ .
