"""Updated CPT database with PLA data

Revision ID: d39b7d78b122
Revises: 59216147215f
Create Date: 2020-05-22 17:07:29.547393+00:00

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'd39b7d78b122'
down_revision = '59216147215f'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('lab',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_lab')),
    schema='cpt'
    )
    op.create_table('manufacturer',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_manufacturer')),
    schema='cpt'
    )
    op.create_table('pla_code',
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.Column('status', sa.String(), nullable=False),
    sa.Column('test_name', sa.String(), nullable=False),
    sa.PrimaryKeyConstraint('code', name=op.f('pk_pla_code')),
    schema='cpt'
    )
    op.create_table('lab_pla_code_mapping',
    sa.Column('lab', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.ForeignKeyConstraint(['code'], ['cpt.pla_code.code'], name=op.f('fk_lab_pla_code_mapping_code_pla_code')),
    sa.ForeignKeyConstraint(['lab'], ['cpt.lab.id'], name=op.f('fk_lab_pla_code_mapping_lab_lab')),
    sa.PrimaryKeyConstraint('lab', name=op.f('pk_lab_pla_code_mapping')),
    schema='cpt'
    )
    op.create_table('manufacturer_pla_code_mapping',
    sa.Column('manufacturer', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.ForeignKeyConstraint(['code'], ['cpt.pla_code.code'], name=op.f('fk_manufacturer_pla_code_mapping_code_pla_code')),
    sa.ForeignKeyConstraint(['manufacturer'], ['cpt.manufacturer.id'], name=op.f('fk_manufacturer_pla_code_mapping_manufacturer_manufacturer')),
    sa.PrimaryKeyConstraint('manufacturer', name=op.f('pk_manufacturer_pla_code_mapping')),
    schema='cpt'
    )
    op.create_table('pla_long_descriptor',
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.Column('descriptor', sa.String(), nullable=False),
    sa.ForeignKeyConstraint(['code'], ['cpt.pla_code.code'], name=op.f('fk_pla_long_descriptor_code_pla_code')),
    sa.PrimaryKeyConstraint('code', name=op.f('pk_pla_long_descriptor')),
    schema='cpt'
    )
    op.create_table('pla_medium_descriptor',
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.Column('descriptor', sa.String(length=48), nullable=False),
    sa.ForeignKeyConstraint(['code'], ['cpt.pla_code.code'], name=op.f('fk_pla_medium_descriptor_code_pla_code')),
    sa.PrimaryKeyConstraint('code', name=op.f('pk_pla_medium_descriptor')),
    schema='cpt'
    )
    op.create_table('pla_short_descriptor',
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.Column('descriptor', sa.String(length=28), nullable=False),
    sa.ForeignKeyConstraint(['code'], ['cpt.pla_code.code'], name=op.f('fk_pla_short_descriptor_code_pla_code')),
    sa.PrimaryKeyConstraint('code', name=op.f('pk_pla_short_descriptor')),
    schema='cpt'
    )
    op.create_table('release_pla_code_mapping',
    sa.Column('release', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=5), nullable=False),
    sa.ForeignKeyConstraint(['code'], ['cpt.pla_code.code'], name=op.f('fk_release_pla_code_mapping_code_pla_code')),
    sa.ForeignKeyConstraint(['release'], ['cpt.release.id'], name=op.f('fk_release_pla_code_mapping_release_release')),
    sa.PrimaryKeyConstraint('release', name=op.f('pk_release_pla_code_mapping')),
    schema='cpt'
    )
    op.add_column('release', sa.Column('effective_date', sa.Date(), nullable=False), schema='cpt')
    op.add_column('release', sa.Column('publish_date', sa.Date(), nullable=False), schema='cpt')
    op.drop_column('release', 'date', schema='cpt')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('release', sa.Column('date', sa.DATE(), autoincrement=False, nullable=False), schema='cpt')
    op.drop_column('release', 'publish_date', schema='cpt')
    op.drop_column('release', 'effective_date', schema='cpt')
    op.drop_table('release_pla_code_mapping', schema='cpt')
    op.drop_table('pla_short_descriptor', schema='cpt')
    op.drop_table('pla_medium_descriptor', schema='cpt')
    op.drop_table('pla_long_descriptor', schema='cpt')
    op.drop_table('manufacturer_pla_code_mapping', schema='cpt')
    op.drop_table('lab_pla_code_mapping', schema='cpt')
    op.drop_table('pla_code', schema='cpt')
    op.drop_table('manufacturer', schema='cpt')
    op.drop_table('lab', schema='cpt')
    # ### end Alembic commands ###
