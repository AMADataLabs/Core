"""Updated linking table column

Revision ID: 024308f6e245
Revises: eb88a3ad7449
Create Date: 2021-10-07 16:46:03.513584+00:00

"""
from alembic import op
import sqlalchemy as sa
from alembic_utils.pg_grant_table import PGGrantTable
from sqlalchemy import text as sql_text

# revision identifiers, used by Alembic.
revision = '024308f6e245'
down_revision = 'eb88a3ad7449'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('residency_program_physician', sa.Column('program', sa.String(), nullable=False), schema='oneview')
    op.drop_constraint('uq_residency_program_physician_personnel_member', 'residency_program_physician', schema='oneview', type_='unique')
    op.create_unique_constraint(op.f('uq_residency_program_physician_program'), 'residency_program_physician', ['program'], schema='oneview')
    op.drop_constraint('fk_residency_program_physician_personnel_member_residen_8bbc', 'residency_program_physician', schema='oneview', type_='foreignkey')
    op.create_foreign_key(op.f('fk_residency_program_physician_program_residency_program'), 'residency_program_physician', 'residency_program', ['program'], ['id'], source_schema='oneview', referent_schema='oneview')
    op.drop_column('residency_program_physician', 'personnel_member', schema='oneview')
    oneview_historical_resident_oneviewadmin_insert = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='INSERT', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_insert)

    oneview_historical_resident_oneviewadmin_references = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='REFERENCES', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_references)

    oneview_historical_resident_oneviewadmin_select = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='SELECT', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_select)

    oneview_historical_resident_oneviewadmin_update = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='UPDATE', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_update)

    oneview_historical_resident_oneviewadmin_delete = PGGrantTable(schema='oneview', table='historical_resident', columns=[], role='oneviewadmin', grant='DELETE', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_delete)

    oneview_historical_resident_oneviewadmin_truncate = PGGrantTable(schema='oneview', table='historical_resident', columns=[], role='oneviewadmin', grant='TRUNCATE', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_truncate)

    oneview_historical_resident_oneviewadmin_trigger = PGGrantTable(schema='oneview', table='historical_resident', columns=[], role='oneviewadmin', grant='TRIGGER', with_grant_option=True)
    op.drop_entity(oneview_historical_resident_oneviewadmin_trigger)

    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    oneview_historical_resident_oneviewadmin_trigger = PGGrantTable(schema='oneview', table='historical_resident', columns=[], role='oneviewadmin', grant='TRIGGER', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_trigger)

    oneview_historical_resident_oneviewadmin_truncate = PGGrantTable(schema='oneview', table='historical_resident', columns=[], role='oneviewadmin', grant='TRUNCATE', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_truncate)

    oneview_historical_resident_oneviewadmin_delete = PGGrantTable(schema='oneview', table='historical_resident', columns=[], role='oneviewadmin', grant='DELETE', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_delete)

    oneview_historical_resident_oneviewadmin_update = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='UPDATE', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_update)

    oneview_historical_resident_oneviewadmin_select = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='SELECT', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_select)

    oneview_historical_resident_oneviewadmin_references = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='REFERENCES', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_references)

    oneview_historical_resident_oneviewadmin_insert = PGGrantTable(schema='oneview', table='historical_resident', columns=['end_year', 'id', 'institution_code', 'medical_education_number', 'specialty', 'start_year', 'training_type'], role='oneviewadmin', grant='INSERT', with_grant_option=True)
    op.create_entity(oneview_historical_resident_oneviewadmin_insert)

    op.add_column('residency_program_physician', sa.Column('personnel_member', sa.VARCHAR(), autoincrement=False, nullable=False), schema='oneview')
    op.drop_constraint(op.f('fk_residency_program_physician_program_residency_program'), 'residency_program_physician', schema='oneview', type_='foreignkey')
    op.create_foreign_key('fk_residency_program_physician_personnel_member_residen_8bbc', 'residency_program_physician', 'residency_program_personnel_member', ['personnel_member'], ['id'], source_schema='oneview', referent_schema='oneview')
    op.drop_constraint(op.f('uq_residency_program_physician_program'), 'residency_program_physician', schema='oneview', type_='unique')
    op.create_unique_constraint('uq_residency_program_physician_personnel_member', 'residency_program_physician', ['personnel_member'], schema='oneview')
    op.drop_column('residency_program_physician', 'program', schema='oneview')
    # ### end Alembic commands ###
