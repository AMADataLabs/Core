#!/usr/bin/env bash

set -ex

PROJECT="${PROJECT:-OneView}"
ENVIRONMENT="${ENVIRONMENT:-sbx}"

$(apigw_assume_role.sh $ENVIRONMENT | grep source)


CODE_BUCKET="ama-${ENVIRONMENT}-datalake-lambda-us-east-1"
FUNCTIONS=(
    "${PROJECT}-${ENVIRONMENT}-addDepartment"
    "${PROJECT}-${ENVIRONMENT}-addFilter"
    "${PROJECT}-${ENVIRONMENT}-addOrg"
    "${PROJECT}-${ENVIRONMENT}-addProfile"
    "${PROJECT}-${ENVIRONMENT}-addSavedColumn"
    "${PROJECT}-${ENVIRONMENT}-addUsers"
    "${PROJECT}-${ENVIRONMENT}-ageGenderMpaAnnual"
    "${PROJECT}-${ENVIRONMENT}-ageGenderMpa"
    "${PROJECT}-${ENVIRONMENT}-dpcByAgeAnnual"
    "${PROJECT}-${ENVIRONMENT}-getAdminUsers"
    "${PROJECT}-${ENVIRONMENT}-getAffiliationMasterData"
    "${PROJECT}-${ENVIRONMENT}-getBusinessMasterData"
    "${PROJECT}-${ENVIRONMENT}-getCounties"
    "${PROJECT}-${ENVIRONMENT}-getDatalabsQuestions"
    "${PROJECT}-${ENVIRONMENT}-getDepartment"
    "${PROJECT}-${ENVIRONMENT}-getDepartments"
    "${PROJECT}-${ENVIRONMENT}-getDremioToken"
    "${PROJECT}-${ENVIRONMENT}-getFilters"
    "${PROJECT}-${ENVIRONMENT}-getGroupUsers"
    "${PROJECT}-${ENVIRONMENT}-getMTPMasterData"
    "${PROJECT}-${ENVIRONMENT}-getOneviewData"
    "${PROJECT}-${ENVIRONMENT}-getOneviewQuestions"
    "${PROJECT}-${ENVIRONMENT}-getOrgMasterData"
    "${PROJECT}-${ENVIRONMENT}-getOrgs"
    "${PROJECT}-${ENVIRONMENT}-getPhysicianAffiliations"
    "${PROJECT}-${ENVIRONMENT}-getPhysicianColumns"
    "${PROJECT}-${ENVIRONMENT}-getPhysicianContactMasterData"
    "${PROJECT}-${ENVIRONMENT}-getPowerBIReportEmbedConfig"
    "${PROJECT}-${ENVIRONMENT}-getProfile"
    "${PROJECT}-${ENVIRONMENT}-getProfiles"
    "${PROJECT}-${ENVIRONMENT}-getResources"
    "${PROJECT}-${ENVIRONMENT}-getSavedColumns"
    "${PROJECT}-${ENVIRONMENT}-getToken"
    "${PROJECT}-${ENVIRONMENT}-getUserDetails"
    "${PROJECT}-${ENVIRONMENT}-getUsers"
    "${PROJECT}-${ENVIRONMENT}-lambdaAuthorizer"
    "${PROJECT}-${ENVIRONMENT}-physicianTypeEthnicity"
    "${PROJECT}-${ENVIRONMENT}-physicianTypeEthnicityAnnual"
    "${PROJECT}-${ENVIRONMENT}-processAccessRequest"
    "${PROJECT}-${ENVIRONMENT}-removeDremioToken"
    "${PROJECT}-${ENVIRONMENT}-saveDatalabsFeedback"
    "${PROJECT}-${ENVIRONMENT}-saveOneviewFeedback"
    "${PROJECT}-${ENVIRONMENT}-specialtyByMpaAnnual"
    "${PROJECT}-${ENVIRONMENT}-specialtyByMpa"
    "${PROJECT}-${ENVIRONMENT}-updateDepartment"
    "${PROJECT}-${ENVIRONMENT}-updateFilter"
    "${PROJECT}-${ENVIRONMENT}-updateGroupUsers"
    "${PROJECT}-${ENVIRONMENT}-updateProfile"
    "${PROJECT}-${ENVIRONMENT}-updateUserDetails"
    "${PROJECT}-${ENVIRONMENT}-updateUserProfile"
    "${PROJECT}-${ENVIRONMENT}-userDataNowFiles"
    "${PROJECT}-${ENVIRONMENT}-validateUser"
    "${PROJECT}-${ENVIRONMENT}-workforceStatsAnnual"
)
BUNDLES=(
    "${PROJECT}/addDepartment.zip"
    "${PROJECT}/addFilter.zip"
    "${PROJECT}/addOrg.zip"
    "${PROJECT}/addProfile.zip"
    "${PROJECT}/addSavedColumn.zip"
    "${PROJECT}/addUsers.zip"
    "${PROJECT}/ageGenderMpaAnnual.zip"
    "${PROJECT}/ageGenderMpa.zip"
    "${PROJECT}/dpcByAgeAnnual.zip"
    "${PROJECT}/getAdminUsers.zip"
    "${PROJECT}/getAffiliationMasterData.zip"
    "${PROJECT}/getBusinessMasterData.zip"
    "${PROJECT}/getCounties.zip"
    "${PROJECT}/getDatalabsQuestions.zip"
    "${PROJECT}/getDepartment.zip"
    "${PROJECT}/getDepartments.zip"
    "${PROJECT}/getDremioToken.zip"
    "${PROJECT}/getFilters.zip"
    "${PROJECT}/getGroupUsers.zip"
    "${PROJECT}/getMTPMasterData.zip"
    "${PROJECT}/getOneviewData.zip"
    "${PROJECT}/getOneviewQuestions.zip"
    "${PROJECT}/getOrgMasterData.zip"
    "${PROJECT}/getOrgs.zip"
    "${PROJECT}/getPhysicianAffiliations.zip"
    "${PROJECT}/getPhysicianColumns.zip"
    "${PROJECT}/getPhysicianContactMasterData.zip"
    "${PROJECT}/getPowerBIReportEmbedConfig.zip"
    "${PROJECT}/getProfile.zip"
    "${PROJECT}/getProfiles.zip"
    "${PROJECT}/getResources.zip"
    "${PROJECT}/getSavedColumns.zip"
    "${PROJECT}/getToken.zip"
    "${PROJECT}/getUserDetails.zip"
    "${PROJECT}/getUsers.zip"
    "${PROJECT}/lambdaAuthorizer.zip"
    "${PROJECT}/physicianTypeEthnicity.zip"
    "${PROJECT}/physicianTypeEthnicityAnnual.zip"
    "${PROJECT}/processAccessRequest.zip"
    "${PROJECT}/removeDremioToken.zip"
    "${PROJECT}/saveDatalabsFeedback.zip"
    "${PROJECT}/saveOneviewFeedback.zip"
    "${PROJECT}/specialtyByMpaAnnual.zip"
    "${PROJECT}/specialtyByMpa.zip"
    "${PROJECT}/updateDepartment.zip"
    "${PROJECT}/updateFilter.zip"
    "${PROJECT}/updateGroupUsers.zip"
    "${PROJECT}/updateProfile.zip"
    "${PROJECT}/updateUserDetails.zip"
    "${PROJECT}/updateUserProfile.zip"
    "${PROJECT}/userDataNowFiles.zip"
    "${PROJECT}/validateUser.zip"
    "${PROJECT}/workforceStatsAnnual.zip"
)

for index in "${!FUNCTIONS[@]}"; do
  aws --no-paginate lambda update-function-code --function-name ${FUNCTIONS[index]} --s3-bucket ${CODE_BUCKET} --s3-key ${BUNDLES[index]} || exit $?
done
