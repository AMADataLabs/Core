#!/bin/bash

set -ex

PROJECT="${PROJECT:-OneView}"
ENVIRONMENT="${ENVIRONMENT:-sbx}"

CODE_BUCKET="ama-${ENVIRONMENT}-datalake-lambda-us-east-1"
FUNCTIONS=(
    "${PROJECT}-${ENVIRONMENT}-ETL"
    # "${PROJECT}-${ENVIRONMENT}-API"
    # "${PROJECT}-${ENVIRONMENT}-addDepartment"
    # "${PROJECT}-${ENVIRONMENT}-addOrg"
    # "${PROJECT}-${ENVIRONMENT}-addProfile"
    # "${PROJECT}-${ENVIRONMENT}-ageGenderMpaAnnual"
    # "${PROJECT}-${ENVIRONMENT}-ageGenderMpa"
    # "${PROJECT}-${ENVIRONMENT}-getAdminUsers"
    # "${PROJECT}-${ENVIRONMENT}-getCounties"
    # "${PROJECT}-${ENVIRONMENT}-getDepartment"
    # "${PROJECT}-${ENVIRONMENT}-getDepartments"
    # "${PROJECT}-${ENVIRONMENT}-getDremioToken"
    # "${PROJECT}-${ENVIRONMENT}-getGridMasterData"
    # "${PROJECT}-${ENVIRONMENT}-getGroupUsers"
    # "${PROJECT}-${ENVIRONMENT}-getOneviewData"
    # "${PROJECT}-${ENVIRONMENT}-getOrgs"
    # "${PROJECT}-${ENVIRONMENT}-getPhysicianColumns"
    # "${PROJECT}-${ENVIRONMENT}-getProfile"
    # "${PROJECT}-${ENVIRONMENT}-getProfiles"
    # "${PROJECT}-${ENVIRONMENT}-getResources"
    # "${PROJECT}-${ENVIRONMENT}-getToken"
    # "${PROJECT}-${ENVIRONMENT}-getUserDetails"
    # "${PROJECT}-${ENVIRONMENT}-getUsers"
    # "${PROJECT}-${ENVIRONMENT}-processAccessRequest"
    # "${PROJECT}-${ENVIRONMENT}-removeDremioToken"
    # "${PROJECT}-${ENVIRONMENT}-specialtyByMpaAnnual"
    # "${PROJECT}-${ENVIRONMENT}-specialtyByMpa"
    # "${PROJECT}-${ENVIRONMENT}-updateDepartment"
    # "${PROJECT}-${ENVIRONMENT}-updateGroupUsers"
    # "${PROJECT}-${ENVIRONMENT}-updateProfile"
    # "${PROJECT}-${ENVIRONMENT}-updateUserDetails"
    # "${PROJECT}-${ENVIRONMENT}-updateUserProfile"
    # "${PROJECT}-${ENVIRONMENT}-validateUser"
)
BUNDLES=(
    "${PROJECT}/ETL.zip"
    # "${PROJECT}/API.zip"
    # "${PROJECT}/addDepartment.zip"
    # "${PROJECT}/addOrg.zip"
    # "${PROJECT}/addProfile.zip"
    # "${PROJECT}/ageGenderMpaAnnual.zip"
    # "${PROJECT}/ageGenderMpa.zip"
    # "${PROJECT}/getAdminUsers.zip"
    # "${PROJECT}/getCounties.zip"
    # "${PROJECT}/getDepartment.zip"
    # "${PROJECT}/getDepartments.zip"
    # "${PROJECT}/getDremioToken.zip"
    # "${PROJECT}/getGridMasterData.zip"
    # "${PROJECT}/getGroupUsers.zip"
    # "${PROJECT}/getOneviewData.zip"
    # "${PROJECT}/getOrgs.zip"
    # "${PROJECT}/getPhysicianColumns.zip"
    # "${PROJECT}/getProfile.zip"
    # "${PROJECT}/getProfiles.zip"
    # "${PROJECT}/getResources.zip"
    # "${PROJECT}/getToken.zip"
    # "${PROJECT}/getUserDetails.zip"
    # "${PROJECT}/getUsers.zip"
    # "${PROJECT}/processAccessRequest.zip"
    # "${PROJECT}/removeDremioToken.zip"
    # "${PROJECT}/specialtyByMpaAnnual.zip"
    # "${PROJECT}/specialtyByMpa.zip"
    # "${PROJECT}/updateDepartment.zip"
    # "${PROJECT}/updateGroupUsers.zip"
    # "${PROJECT}/updateProfile.zip"
    # "${PROJECT}/updateUserDetails.zip"
    # "${PROJECT}/updateUserProfile.zip"
    # "${PROJECT}/validateUser.zip"
)

for index in "${!FUNCTIONS[@]}"; do
  aws --no-paginate lambda update-function-code --function-name ${FUNCTIONS[index]} --s3-bucket ${CODE_BUCKET} --s3-key ${BUNDLES[index]} || exit $?
done
